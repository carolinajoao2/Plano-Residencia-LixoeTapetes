<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="utf-8">
<title>Plano de Lixo &amp; Tapetes (Nov 2025 – Jul 2026)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --today:#feeec6;--weekend:#f7f7f7;
  --badge:#0075ff;--badge-text:#fff;
  --border:#ddd;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu
}
body{margin:0;padding:1rem;line-height:1.4}
h1{margin:0 0 1rem;font-size:1.4rem;text-align:center}
section.month{border:1px solid var(--border);margin-bottom:.8rem;border-radius:6px;overflow:hidden}
header.month-head{display:flex;align-items:center;justify-content:space-between;background:#f0f0f0;padding:.4rem .6rem;cursor:pointer}
header.month-head h2{margin:0;font-size:1.1rem}
header.month-head .stats{font-size:.8rem;color:#666}
header.month-head .toggle{font-weight:bold;transform:rotate(90deg);transition:.2s}
header.month-head[aria-expanded="true"] .toggle{transform:rotate(0)}
.calendar-wrapper{overflow-x:auto}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);border-top:1px solid var(--border);min-width:560px}
.day-name,.day{padding:.35rem;border-right:1px solid var(--border);border-bottom:1px solid var(--border);min-height:4.5rem;position:relative;font-size:.8rem;box-sizing:border-box}
.day-name{background:#eee;text-align:center;font-weight:600}
.day:nth-child(7n),.day-name:nth-child(7n){border-right:none}
.day.weekend{background:var(--weekend)}
.day.today{background:var(--today)}
.day .date{font-size:.75rem;font-weight:600}
.badge{background:var(--badge);color:var(--badge-text);border-radius:4px;padding:0 .2rem;font-size:.66rem;display:inline-block;margin-top:.2rem}
.check{display:block;margin-top:.15rem}
.week-head{grid-column:1/8;background:#e4eefc;padding:.2rem .4rem;font-size:.75rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
button{padding:.3rem .6rem;margin:.4rem auto;display:block}
@media print{
  button,header.month-head .toggle{display:none!important}
  section.month[aria-expanded="false"]{display:none!important}
}
</style>
</head>
<body>
<h1>Plano de Lixo &amp; Tapetes (Nov 2025 – Jul 2026)</h1>

<div id="months"></div>
<button id="clear">Limpar registos</button>

<script>
// ---------- Configuração ----------
const startDate=new Date('2025-11-01');
const endDate=new Date('2026-07-31');
const rooms=[...Array(11)].map((_,i)=>`2.${i+1}`).filter(r=>r!=='2.3');
const locale='pt-PT';

// ---------- Utilitários ----------
function isoWeek(d){
  const t=new Date(d);t.setHours(0,0,0,0);
  t.setDate(t.getDate()+(4-(t.getDay()||7)));
  const yStart=new Date(t.getFullYear(),0,1);
  return t.getFullYear()+'-W'+String(Math.ceil(((t-yStart)/86400000+1)/7)).padStart(2,'0');
}
function rangeMonths(d1,d2){
  const arr=[];let m=new Date(d1.getFullYear(),d1.getMonth(),1);
  while(m<=d2){arr.push(new Date(m));m.setMonth(m.getMonth()+1)}
  return arr;
}

// ---------- Rotação ----------
const eligibleTrashWeekdays = [1,3,5];      // 2ª,4ª,6ª (Mon=1)
const overrideStart = new Date();            // começa hoje
overrideStart.setHours(0,0,0,0);
const overrideEnd   = new Date('2026-02-01'); // até 1 Fev 2026 (exclusivo)

// quartos sem o 2.3 durante o override
const roomsNo23 = rooms.filter(r => r !== '2.3');

// util: primeiro dia elegível (2ª/4ª/6ª) em/apos uma data
function firstEligibleOnOrAfter(d){
  const x = new Date(d); x.setHours(0,0,0,0);
  while(!eligibleTrashWeekdays.includes(x.getDay())) x.setDate(x.getDate()+1);
  return x;
}

// conta quantos dias elegíveis existem entre duas datas (inclusive do fim)
function countEligible(from, to){
  let c = 0, d = new Date(from);
  d.setHours(0,0,0,0);
  while (d <= to){
    if (eligibleTrashWeekdays.includes(d.getDay())) c++;
    d.setDate(d.getDate()+1);
  }
  return c;
}

const overrideAnchor = firstEligibleOnOrAfter(overrideStart);

function roomForTrash(date){
  // fora dos dias de lixo: nunca há atribuição
  if (!eligibleTrashWeekdays.includes(date.getDay())) return '';

  // período especial (até fevereiro): alterna “com / vazio” e ignora 2.3
  if (date >= overrideAnchor && date < overrideEnd){
    // k = índice do dia elegível (0 no primeiro dia ≥ hoje)
    const k = countEligible(overrideAnchor, date) - 1; // -1 para 0-based
    if (k % 2 === 1) return '';                        // dias ímpares → vazio
    const idx = Math.floor(k/2) % roomsNo23.length;    // 0,1,2,… cíclico
    return roomsNo23[idx];                             // 2.1, -, 2.2, -, 2.4, …
  }

  // funcionamento normal (antes do reset e depois de fevereiro):
  // roda por todos os quartos (inclui 2.3) em cada dia elegível
  let count = 0;
  const d = new Date(startDate);
  d.setHours(0,0,0,0);
  while (d < date){
    if (eligibleTrashWeekdays.includes(d.getDay())) count++;
    d.setDate(d.getDate()+1);
  }
  return rooms[count % rooms.length];
}


// ---------- LocalStorage ----------
const save=(t,id,v)=>localStorage.setItem(`${t}-${id}`,v?1:0);
const load=(t,id)=>localStorage.getItem(`${t}-${id}`)==1;

// ---------- Criação ----------
const monthsDiv=document.getElementById('months');
const today=new Date();

rangeMonths(startDate,endDate).forEach(month=>{
  const sec=document.createElement('section');sec.className='month';
  const expanded=month.getFullYear()>today.getFullYear()||
                 (month.getFullYear()==today.getFullYear()&&month.getMonth()>=today.getMonth());
  sec.setAttribute('aria-expanded',expanded);

  // Cabeçalho do mês
  const head=document.createElement('header');head.className='month-head';
  head.innerHTML=`<span class="toggle">▶</span><h2>${month.toLocaleString(locale,{month:'long',year:'numeric'})}</h2><span class="stats"></span>`;
  head.onclick=()=>sec.setAttribute('aria-expanded',sec.getAttribute('aria-expanded')==='true'?'false':'true');
  sec.appendChild(head);

  const wrap=document.createElement('div');wrap.className='calendar-wrapper';
  const cal=document.createElement('div');cal.className='calendar';
  wrap.appendChild(cal);sec.appendChild(wrap);

  // Nomes dias
  ['Seg','Ter','Qua','Qui','Sex','Sáb','Dom'].forEach(d=>cal.insertAdjacentHTML('beforeend',`<div class="day-name">${d}</div>`));

  const firstDow=(month.getDay()+6)%7, dim=new Date(month.getFullYear(),month.getMonth()+1,0).getDate();
  for(let i=0;i<firstDow;i++)cal.insertAdjacentHTML('beforeend','<div class="day"></div>');

  let trashDone=0,trashTot=0,rugDone=0,rugTot=0;

  for(let day=1;day<=dim;day++){
    const date=new Date(month.getFullYear(),month.getMonth(),day);

    // cabeçalho semanal (segunda-feira)
    if(date.getDay()===1){
      const wId=isoWeek(date), roomR=roomForRugs(wId), done=load('rugs',wId);
      rugTot++; if(done)rugDone++;
      cal.insertAdjacentHTML('beforeend',
        `<div class="week-head"><span>Semana ${wId} — Tapetes: ${roomR}</span>
         <label><input type="checkbox" ${done?'checked':''}></label></div>`);
      cal.lastElementChild.querySelector('input').onchange=e=>{save('rugs',wId,e.target.checked);updateStats();}
    }

    const roomT=roomForTrash(date), id=date.toISOString().slice(0,10), done=load('trash',id);
    if(roomT){trashTot++; if(done)trashDone++;}

    cal.insertAdjacentHTML('beforeend',
      `<div class="day${[0,6].includes(date.getDay())?' weekend':''}${date.toDateString()==today.toDateString()?' today':''}">
        <span class="date">${day}</span>`+
        (roomT?`<span class="badge">Lixo: ${roomT}</span>
         <label class="check"><input type="checkbox" ${done?'checked':''}></label>`:'')+
       `</div>`);

    const inp=cal.lastElementChild.querySelector('input');
    if(inp) inp.onchange=e=>{save('trash',id,e.target.checked);updateStats();}
  }

  monthsDiv.appendChild(sec);
  updateStats();

  function updateStats(){
    head.querySelector('.stats').textContent=
      `Lixo ${trashDone}/${trashTot} ‧ Tapetes ${rugDone}/${rugTot}`;
  }
});

// limpar registos
document.getElementById('clear').onclick=()=>{if(confirm('Apagar todos os registos?')){localStorage.clear();location.reload();}};
</script>
</body>
</html>


